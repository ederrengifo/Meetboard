<aside id="sidebar" class="width-22">
    <% if current_user %>
        <div class="user-options">
            <a href="/" class="username">
                <%= current_user.name %>
            </a>
            <%= link_to "Sign out", signout_path, id: "sign_out", class: "signout" %>
        </div>
        <% if @event.present? %>
            <div class="events-toggle">
                <button id="show-new-events" onclick="showUpcoming()" class="<%= 'active' if @event.ends.to_i > Time.now.to_i %>">Upcoming</button>
                <button id="show-past-events" onclick="showPast()" class="<%= 'active' if @event.ends.to_i < Time.now.to_i %>">Latest</button>
            </div>
        <% else %>
            <div class="events-toggle">
                <button id="show-new-events" onclick="showUpcoming()" class="active">Upcoming</button>
                <button id="show-past-events" onclick="showPast()" class="">Latest</button>
            </div>
        <% end %>

    <div class="scroll-bar-container">
        <% if @event.present? %>
            <div id="new-events" class="<%= 'hidden' if @event.ends.to_i < Time.now.to_i %>">
        <% else %>
            <div id="new-events" class="">
        <% end %>
        <% @calendar_days.each do |day, calendars| %>
            <h2>
                <% if day == @today %>
                    Today
                <% else %>
                    <% if day == @tomorrow %>
                        Tomorrow
                    <% else %>
                        <%= day.strftime("%A %d") %> 
                    <% end %>
                <% end %>
            </h2>
            <ul>
                <% for calendar in calendars %>
                    <% if @event.present? %>
                        <li class="<%= 'active' if @event.gid == calendar.id %>">
                    <% else %>
                        <li>
                    <% end %>

                        <%= link_to(calendar.id, class:"event-link") do %>
                            <div class="event-name">
                                <%= calendar.summary %>
                            </div>
                            <div class="timelapse">
                                <%= calendar.start.date_time&.strftime("%I:%M%p")%> to <%=calendar.end.date_time&.strftime("%I:%M%p") %>
                            </div>
                        <% end %>
                    </li>
                <% end %>
            </ul>
        <% end %>
        </div>
        <% if @event.present? %>
            <div id="past-events" class="<%= 'hidden' if @event.ends.to_i > Time.now.to_i %>">
        <% else %>
            <div id="past-events" class="hidden">
        <% end %>
            <h2>Latest events</h2>
            <ul>
                <% @latest_events.each do |event| %>
                    <% if event.ends.to_i < Time.now.to_i %>
                        <% if @event.present? %>
                            <li class="<%= 'active' if @event.gid == event.gid %>">
                        <% else %>
                            <li>
                        <% end %>
                                <%= link_to(event.id, class:"event-link") do %>
                                    <div class="event-name">
                                        <%= event.title %>
                                    </div>
                                    <div class="timelapse">
                                        <%= event.starts&.strftime("%B, %d") %> at <%= event.starts&.strftime("%I:%M%p") %>
                                    </div>
                                <% end %>
                            </li>
                    <% end %>
                <% end %>
            </ul>
        </div>

    </div>

    <% end %>

    <script>
        var showUpcomingBtn = document.getElementById("show-new-events");
        var showPastBtn = document.getElementById("show-past-events");
        var upcomingEvents = document.getElementById("new-events");
        var pastEvents = document.getElementById("past-events");

        function showPast() {
            upcomingEvents.classList.add("hidden");
            pastEvents.classList.remove("hidden");
            showUpcomingBtn.classList.remove("active");
            showPastBtn.classList.add("active");
        }

        function showUpcoming() {
            upcomingEvents.classList.remove("hidden");
            pastEvents.classList.add("hidden");
            showUpcomingBtn.classList.add("active");
            showPastBtn.classList.remove("active");
        }

    </script>
    
</aside>
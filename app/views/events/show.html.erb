<main class="board">

    <%= render "sidebar" %>

    <div id="workspace" class="width-48">
        <div class="scroll-workspace-container">
            <div class="layout-control">
                <button class="sidebar-toggle" id="toggle-left" onclick="toggleLeft()">
                    Sidebar
                </button>
            </div>
            <h1>
                <%= @event.title %>
            </h1>
            <div class="event-tabs">
                
                <button class="details" onclick="showDetails()" id="event-details-btn">
                    Details
                </button>
                
                <button class="details">
                    Attendees
                </button>

                <button class="details">
                    Role: Participant
                </button>

                <% if @event.hangout_link != nil %>
                    <a href="<%= @event.hangout_link %>" target="_blank">
                        Meet link
                    </a>
                <% end %>

                <div id="event-details" class="hidden">
                    <div class="details-wrapper">
                        <% if @event.description != nil %>
                            <h4>Description</h4>
                            <p>
                                <%= @event.description.html_safe %>
                            </p>
                        <% end %>
                        <h4>Date</h4>
                        <p>
                            <%= @event.starts.strftime("%A, %B %d") %>
                        </p>
                        <h4>Time</h4>
                        <p>
                            From <%= @event.starts.strftime("%I:%M%p") %> to <%= @event.ends.strftime("%I:%M%p") %> (<%= @event_difference %>)
                        </p>
                        <h4>Created by</h4>
                        <p>
                            <%= @event.creator %>
                        </p>
                        <% if @event.location != nil %>
                            <h4>Location</h4> 
                            <p>
                                <%= @event.location %>
                            </p> 
                        <% end %>
                    </div>
                </div>
            </div>
            

            <%= render 'form', event: @event %>

        </div>
    </div>

    <div id="todobar" class="width-30">
        <div class="scroll-todobar-container">
            <div class="tabs">
                <button class="todo-tab active" id="event-task-tab" onclick="showEventTasks()">
                    Action items
                    (<%= @event.tasks.where(completed: false).count %>)
                </button>
                <button class="todo-tab" id="all-tasks-tab" onclick="showAllTasks()">
                    All Time
                    (<%= @tasks.where(completed: false).count unless @tasks.count == 0 %>) 
                </button>
                <div class="cleaner">
                    <button id="clear-events" onclick="cleanTasks()" class="clear-tasks">
                        Clean
                    </button>
                </div>
            </div>

            <div class="tasks-container" id="event-task-block">
                <div id="event-tasks-cleaned" class="hidden">
                    <% @event.tasks.each do |task| %>
                        <% if task.completed == false %>
                            <%= render partial: 'tasks/task', locals: { task: task } %>
                        <% end %>
                    <% end %>
                </div>
                <div id="event-tasks-all" class="">
                    <% @event.tasks.each do |task| %>
                        <%= render partial: 'tasks/task', locals: { task: task } %>
                    <% end %>
                </div>
                <%= render 'tasks/form' %>
            </div>

            <div class="task-container hidden" id="all-tasks-block">

                <div id ="alltime-tasks-cleaned" class="hidden">
                    <% @task_grouping.each do |event_id, tasks| %>
                        <div class="task-group">
                            <a href="<%= event_id %>" class="event">
                                <%= Event.find(event_id).title %>
                            </a>
                        </div>
                        <% for task in tasks %>
                            <div class="task">
                                <% if task.completed == false %>
                                    <label class="container-update">
                                        <%= task.title %>  <%= link_to 'Delete', [task.event, task], method: :delete, class: "delete-task" %>
                                        <%= form_with(model: [task.event, task], local: true) do |f| %>
                                            <% if task.completed == false %>
                                                <%= f.check_box :completed, :checked => true, :style => 'display: none' %>
                                                <%= f.submit "", class: "mark" %>
                                            <% else %>
                                                <%= f.check_box :completed, :checked => false, :style => 'display: none' %>
                                                <%= f.submit "", class: "unmark" %>
                                            <% end %>
                                        <% end %>
                                    </label>
                                <% end %>
                            </div>
                        <% end %>
                    <% end %>
                </div>

                <div id ="alltime-tasks-all" class="">
                    <% @task_grouping.each do |event_id, tasks| %>
                        <div class="task-group">
                            <a href="<%= event_id %>" class="event">
                                <%= Event.find(event_id).title %>
                            </a>
                        </div>
                        <% for task in tasks %>
                            <div class="task">
                                <label class="container-update">
                                    <%= task.title %>  <%= link_to 'Delete', [task.event, task], method: :delete, class: "delete-task" %>
                                    <%= form_with(model: [task.event, task], local: true) do |f| %>
                                        <% if task.completed == false %>
                                            <%= f.check_box :completed, :checked => true, :style => 'display: none' %>
                                            <%= f.submit "", class: "mark" %>
                                        <% else %>
                                            <%= f.check_box :completed, :checked => false, :style => 'display: none' %>
                                            <%= f.submit "", class: "unmark" %>
                                        <% end %>
                                    <% end %>
                                </label>
                            </div>
                        <% end %>
                    <% end %>
                </div>

            </div>
            
        </div>
    </div>

    <script>
        var eventDetails = document.getElementById("event-details");
        var buttonDetails = document.getElementById("event-details-btn");

        function showDetails() {
            eventDetails.classList.toggle("hidden");
            buttonDetails.classList.toggle("active");
        }

        var eventTaskTab = document.getElementById("event-task-tab");
        var allTasksTab = document.getElementById("all-tasks-tab");
        var eventTaskBlock = document.getElementById("event-task-block");
        var allTasksBlock = document.getElementById("all-tasks-block")

        function showEventTasks() {
            eventTaskBlock.classList.remove("hidden");
            allTasksBlock.classList.add("hidden");
            eventTaskTab.classList.add("active");
            allTasksTab.classList.remove("active");
        }

        function showAllTasks() {
            eventTaskBlock.classList.add("hidden");
            allTasksBlock.classList.remove("hidden");
            eventTaskTab.classList.remove("active");
            allTasksTab.classList.add("active");
        }

        var toggleLeftBtn = document.getElementById("toggle-left");
        var leftBlock = document.getElementById("sidebar");
        var centerBlock = document.getElementById("workspace");
        var rightBlock = document.getElementById("todobar");

        function toggleLeft() {
            toggleLeftBtn.classList.toggle("layout-active");
            leftBlock.classList.toggle("width-22");
            leftBlock.classList.toggle("hidden");
            centerBlock.classList.toggle("width-48");
            centerBlock.classList.toggle("width-59");
            rightBlock.classList.toggle("width-30");
            rightBlock.classList.toggle("width-41");
        }

        var clearBtn = document.getElementById("clear-events");
        var eventTasksCleaned = document.getElementById("event-tasks-cleaned");
        var eventTasksAll = document.getElementById("event-tasks-all");
        var alltimeTasksCleaned = document.getElementById("alltime-tasks-cleaned");
        var alltimeTasksAll = document.getElementById("alltime-tasks-all");

        function cleanTasks()Â {
            eventTasksCleaned.classList.toggle("hidden");
            eventTasksAll.classList.toggle("hidden");
            alltimeTasksCleaned.classList.toggle("hidden");
            alltimeTasksAll.classList.toggle("hidden");
            clearBtn.classList.toggle("active");
        }

    </script>
  
</main>

